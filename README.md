# slgGamer

## 目的是为了让项目驱动学习，而不是做成一个游戏

一、SLG 游戏服务器的核心难点
1. 世界状态规模大
   SLG 通常有一个“持续运行”的大地图，地图上有成千上万的格子、城池、部队、资源点。

世界状态是长生命周期数据，不能像对战类游戏一样短时开房间、打完就销毁。

难点：如何高效存储 & 快速读取地图数据、避免频繁全量加载。

2. 高并发数据修改
   多个玩家可能同时修改相同的世界数据（抢同一块地、打同一个城、采同一个矿）。

必须保证数据一致性（不能出现两个玩家都成功占领一格的情况）。

难点：分布式锁、乐观锁、原子操作的性能和延迟平衡。

3. 战斗计算复杂
   SLG 战斗不是瞬间结算，可能是回合制或持续型战斗（行军、驻守、攻城）。

战斗受兵种、科技、地形、天气、BUFF 等影响，计算量大。

难点：大规模战斗的并行计算、跨节点战斗的同步。

4. 长时间行为管理
   行军、建筑升级、科技研究等动作可能持续数分钟到数小时。

需要定时器系统高效管理成千上万个长时间任务。

难点：定时器性能（内存占用、时间精度、持久化）。

5. 联盟与多人协作
   联盟功能涉及联盟战、共享资源、盟友支援、跨服战。

这类数据可能跨多个逻辑服、甚至跨大区。

难点：跨服消息同步 & 数据一致性。

6. 持久化与容灾
   SLG 玩家投资的时间长，数据丢失无法挽回。

需要高可用数据库、定期快照、增量备份、热备节点。

难点：大规模数据备份时不影响在线性能。

7. 热更新 & 版本兼容
   游戏迭代频繁，不能频繁停服。

必须考虑数据结构升级、协议变更、旧版本客户端兼容。

难点：无缝热更新、数据迁移的自动化。

二、功能设计模块（逻辑层面）
1. 核心逻辑层
   地图模块

格子数据（地形、资源、建筑、占领状态）

地图分区 & 按需加载（分片）

玩家模块

资源系统（金木石粮等）

城池管理（建筑、升级、科技）

部队系统（编队、行军、战斗）

战斗模块

行军路线计算

战斗公式计算

结算 & 战报生成

任务与活动

日常任务、活动、成就

跨服活动（国战、城战）

2. 社交与联盟层
   联盟管理（创建、邀请、审批）

联盟科技 & 共享资源

联盟战 / 国战（跨服、分布式战斗计算）

聊天系统（世界、联盟、私聊、广播）

3. 系统支撑层
   定时器服务

支持百万级定时任务

持久化 + 异步调度

事件驱动系统

玩家动作 → 触发事件 → 模块解耦

任务队列

延迟任务（建筑升级、科技完成）

并行计算任务（战斗、AI）

跨服通讯

消息网关（Gateway）

跨服 RPC（gRPC / TCP）

数据存储

热数据（Redis）

冷数据（MySQL / PostgreSQL）

大地图存储（分片存储 + 缓存）

日志与监控

战斗日志、玩家行为日志

服务器性能监控（Prometheus + Grafana）

